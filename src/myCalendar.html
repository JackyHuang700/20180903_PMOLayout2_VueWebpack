<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>mTerrace PMO | Dashboard</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="css/skins/_all-skins.min.css">
  <!-- Morris chart -->
  <link rel="stylesheet" href="bower_components/morris.js/morris.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css">
  <!-- Date Picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
  <link rel="stylesheet" href="css/style.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
  <link rel="stylesheet" href="css/test.css">

  <!-- fullcalendar -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css">
  <style>
    .popoverContent input {
      margin-bottom: 10px;
    }

    .popoverContent button {
      display: block;
      margin-left: auto;
      margin-right: 0;
    }

    .fc-event {
      overflow: hidden;
    }

    .fc-content {
      display: inline-block;
    }

    .fc-delete {
      float: right;
      height: 100%;
      line-height: 19px;
    }
  </style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
  <div class="wrapper">

    <header class="main-header">
      <a href="index.html" class="logo">
        <img class="logoImg" src="./img/brand/logo.png" alt="">
      </a>
      <nav class="navbar navbar-static-top">
        <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
          <span class="sr-only">Toggle navigation</span>
        </a>
        <div class="navbar-custom-menu-left">
          <ul class="nav navbar-nav">
            <li class="dropdown messages-menu">
              <a href="#" class="dropdown-toggle iconAnim" data-toggle="dropdown">
                <i class="fa fa-envelope-o"></i>
                <span class="label label-success">4</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="navbar-custom-menu">
          <ul class="nav navbar-nav">
            <li class="dropdown user user-menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="img/user2-160x160.jpg" class="user-image" alt="User Image">
                <span class="hidden-xs">&nbsp;</span>
              </a>
              <ul class="dropdown-menu">
                <li class="user-header">
                  <img src="img/user2-160x160.jpg" class="img-circle" alt="User Image">

                  <p class="text-bold">
                    Alexander Pierce
                  </p>
                  <p>
                    <small>Web Developer</small>
                  </p>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="fa fa-bell-o"></i> Profile
                  </a>
                </li>

                <li>
                  <div class="dropdown-header text-center">
                    <strong>Account</strong>
                  </div>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="fa fa-bell-o"></i> Updates
                    <span class="badge badge-info">42</span>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="fa fa-bell-o"></i> Sign Out
                  </a>
                </li>
              </ul>
            </li>

          </ul>
        </div>
      </nav>
    </header>
    <aside class="main-sidebar">
      <section class="sidebar">
        <ul class="sidebar-menu" data-widget="tree">
          <li><a href="#"><i class="fa fa-circle-o text-aqua"></i> <span>Dashboard</span></a></li>
          <li class="header">MAIN NAVIGATION</li>
          <li class="treeview">
            <a href="#">
              <i class="fa fa-dashboard"></i> <span>Demo Views</span>
              <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span>
            </a>
            <ul class="treeview-menu">
              <li class="active"><a href="loginV2.html"><i class="fa fa-circle-o"></i> login</a></li>
              <li><a href="changePasswordV2.html"><i class="fa fa-circle-o"></i> 忘記密碼</a></li>
              <li><a href="dragula.html"><i class="fa fa-circle-o"></i> 我的工作區</a></li>
              <li><a href="myCalendar.html"><i class="fa fa-circle-o"></i> 我的日歷</a></li>
              <li><a href="myJobs.html"><i class="fa fa-circle-o"></i> 我的專案</a></li>
            </ul>
          </li>
        </ul>
      </section>
    </aside>

    <div class="content-wrapper">
      <section class="content-header">
        <h1>
          Dashboard
          <small>panel</small>
        </h1>
        <ol class="breadcrumb">
          <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
          <li class="active">Dashboard</li>
        </ol>
      </section>

      <section class="content">


        <div id='calendar'></div>



      </section>
    </div>
    <footer class="main-footer">
      <div class="pull-right hidden-xs">
        <b>Version</b> 0.0.0
      </div>
      <strong>Copyright &copy; 2018 Powered by<a href="https://www.mterrace.com.tw/"> mTERRACE</a>.</strong> All rights
      reserved.
    </footer>


    <div class="control-sidebar-bg"></div>
  </div>

  <!-- jQuery 3 -->
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button);
  </script>
  <!-- Bootstrap 3.3.7 -->
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <!-- Morris.js charts -->
  <script src="bower_components/raphael/raphael.min.js"></script>
  <script src="bower_components/morris.js/morris.min.js"></script>
  <!-- Sparkline -->
  <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
  <!-- jvectormap -->
  <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
  <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
  <!-- jQuery Knob Chart -->
  <script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
  <!-- daterangepicker -->
  <script src="bower_components/moment/min/moment.min.js"></script>
  <script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
  <!-- datepicker -->
  <script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
  <!-- Bootstrap WYSIHTML5 -->
  <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
  <!-- Slimscroll -->
  <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
  <!-- FastClick -->
  <script src="bower_components/fastclick/lib/fastclick.js"></script>
  <!-- AdminLTE App -->
  <script src="js/adminlte.min.js"></script>
  <!-- fullcalendar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
  <!-- jQuery UI -->
  <!-- <script src="https://code.jquery.com/ui/1.10.3/jquery-ui.min.js" integrity="sha256-lnH4vnCtlKU2LmD0ZW1dU7ohTTKrcKP50WA9fa350cE="
    crossorigin="anonymous"></script> -->
  <script>

    var data = [
      {
        title: 'All Day Event',
        start: '2015-02-01'
      },
      {
        title: 'Long Event',
        start: '2015-02-07',
        end: '2015-02-10'
      },
      {
        id: 999,
        title: 'Repeating Event',
        start: '2015-02-09T16:00:00'
      },
      {
        id: 999,
        title: 'Repeating Event',
        start: '2015-02-16T16:00:00'
      },
      {
        title: 'Conference',
        start: '2015-02-11',
        end: '2015-02-13'
      },
      {
        title: 'Meeting',
        start: '2015-02-12T10:30:00',
        end: '2015-02-12T12:30:00'
      },
      {
        title: 'Lunch',
        start: '2015-02-12T12:00:00'
      },
      {
        title: 'Meeting',
        start: '2015-02-12T14:30:00'
      },
      {
        title: 'Happy Hour',
        start: '2015-02-12T17:30:00'
      },
      {
        title: 'Dinner',
        start: '2015-02-12T20:00:00'
      },
      {
        title: 'Birthday Party',
        start: '2015-02-13T07:00:00'
      },
      {
        title: 'Click for Google',
        url: 'https://google.com/',
        start: '2015-02-28'
      }
    ]

    var newData = [
      {
        title: 'stuff',
        start: '2015-03-01'
      },
      {
        title: 'stuff',
        start: '2015-03-02'
      }
    ]
    var popTemplate = [
      '<div class="popover" style="max-width:600px;" >',
      '<div class="arrow"></div>',
      '<div class="popover-header">',
      '<button id="closepopover" type="button" class="close" aria-hidden="true">&times;</button>',
      '<h3 class="popover-title"></h3>',
      '</div>',
      '<div class="popover-content"></div>',
      '</div>'].join('')
    var popoverElement
    var calendarSelectStart
    var calendarSelectEnd

    $(document).ready(function () {
      var savePopoverDom = document.getElementById('savePopover')
      var calendarDom = document.getElementById('calendar')

      $(calendarDom).fullCalendar({
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'month,agendaWeek,agendaDay'
        },
        defaultDate: '2015-02-12',
        navLinks: true, // can click day/week names to navigate views
        selectable: true,
        selectHelper: true,
        select: function (start, end, jsEvent) {
          closePopovers()

          popoverElement = $(jsEvent.target)
          $(jsEvent.target).popover({
            title: 'the title',
            content: function () {
              return (
                '<div class="popoverContent">' +
                '  <input type="text" class="form-control" id="popoverContentInput"/>' +
                '  <button type="button" class="btn btn-primary" id="savePopover">儲存</button>' +
                '</div>'
              )
            },
            template: popTemplate,
            placement: 'left',
            html: 'true',
            trigger: 'click',
            animation: 'true',
            container: 'body'
          }).popover('show')
          calendarSelectStart = start
          calendarSelectEnd = end
        },
        eventClick: function (calEvent, jsEvent, view) {
          popoverElement = $(jsEvent.currentTarget)
        },
        eventRender: function (event, element) {
          element.append("<span class='closeon fc-delete'>X</span>");
          element.find(".closeon").click(function () {
            if (confirm("確認刪除?")) {
              $('#calendar').fullCalendar('removeEvents', event._id);
            }
          });
        },
        editable: true,
        eventLimit: true,
        events: data
      })

      $(calendarDom).on('click', '.fc-next-button', function () {
        // alert('clicked');
        $(calendarDom).fullCalendar('removeEvents')
        $(calendarDom).fullCalendar('addEventSource', newData)
      })
      $(calendarDom).on('click', '.fc-prev-button', function () {
        // alert('clicked');
        $(calendarDom).fullCalendar('removeEvents')
        $(calendarDom).fullCalendar('addEventSource', data)
      })

      $(document).on('click', '#savePopover', function (e) {
        console.log('ee')
        var popoverContentInputDom = document.getElementById('popoverContentInput')
        if (popoverContentInputDom.value) {
          $(calendarDom).fullCalendar('renderEvent', {
            title: popoverContentInputDom.value,
            start: calendarSelectStart,
            end: calendarSelectEnd
          }, true) // stick? = true

        }
        $(calendarDom).fullCalendar('unselect')
        closePopovers()
      })

      $('body').on('click', function (e) {
        // close the popover if: click outside of the popover || click on the close button of the popover
        if (popoverElement && ((!popoverElement.is(e.target) && popoverElement.has(e.target).length === 0 && $('.popover').has(e.target).length === 0) || (popoverElement.has(e.target) && e.target.id === 'closepopover'))) {
          /// $('.popover').popover('hide'); --> works

          closePopovers()
        }
      })

      function closePopovers() {
        $('.popover').not(this).popover('hide')
      }
    })


  </script>
</body>

</html>

<!-- https://codepen.io/usamahamed/pen/ZvbGBg -->